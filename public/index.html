<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film Compatibility Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url("https://fonts.googleapis.com/css?family=Inter:900,800,600,500,400,700");
        * {
            font-family: 'Inter', Helvetica, sans-serif;
        }
        input:focus {
            outline: none !important;
            box-shadow: none !important;
            border: none !important;
        }
        input:focus-visible {
            outline: none !important;
        }
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px #fbf9f5 inset !important;
            -webkit-text-fill-color: #141414 !important;
            background-color: transparent !important;
            box-shadow: none !important;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontSize: {
                        '150px': '150px',
                        '100px': '100px',
                        '40px': '40px'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-[#fbf9f5] min-h-screen flex justify-center">
    <div class="flex flex-col items-center gap-0 px-4 md:px-[66px] pt-12 md:pt-[60px] pb-12 md:pb-[86px] relative bg-[#fbf9f5] w-full max-w-7xl scale-75 md:scale-[0.6]" style="transform-origin: center top;">
        <!-- Header Section -->
        <div class="flex flex-col items-center relative self-stretch w-full">
            <div class="relative w-full mt-[-1.00px] flex justify-center mb-4 md:mb-8">
                <img src="matchboxd-logo.svg" alt="MATCHBOXD" class="h-16 md:h-24 w-auto max-w-full">
            </div>
            <p class="relative self-stretch font-normal text-[#141414] text-lg md:text-3xl text-center tracking-[0] leading-[normal] mb-4 md:mb-8">
                Compare <a href="https://letterboxd.com/" target="_blank" rel="noopener noreferrer" class="underline hover:no-underline">Letterboxd</a> ratings to find out how similar your film tastes really are
            </p>
        </div>

        <!-- Input and Button Section -->
        <div class="flex flex-col items-center gap-4 md:gap-[30px] relative self-stretch w-full mt-4 md:mt-8">
            <div class="flex flex-col md:flex-row items-center gap-4 md:gap-[26px] relative justify-center w-full">
                <!-- Username Input Container -->
                <div class="relative w-full md:w-[664px] h-[60px] md:h-[92px]">
                    <div class="w-full md:w-[660px] h-[60px] md:h-[92px] bg-[#fbf9f5] relative rounded-2xl border-[3px] border-solid border-[#141414]">
                        <input type="text" id="username1" placeholder="username #1" spellcheck="false"
                               class="absolute top-[15px] md:top-[26px] left-[20px] md:left-[50px] font-bold text-[#141414] text-[18px] md:text-[24px] tracking-[0] leading-[normal] bg-transparent border-none outline-none placeholder-[#141414] placeholder-opacity-30 w-[120px] md:w-[250px] focus:outline-none focus:ring-0 focus:border-none">
                        <div class="absolute w-[1px] h-[30px] md:h-[50px] top-[15px] md:top-[21px] left-[50%] md:left-[322px] bg-[#141414] transform -translate-x-1/2 md:transform-none"></div>
                        <input type="text" id="username2" placeholder="username #2" spellcheck="false"
                               class="absolute top-[15px] md:top-[26px] right-[20px] md:left-[390px] font-bold text-[#141414] text-[18px] md:text-[24px] tracking-[0] leading-[normal] bg-transparent border-none outline-none placeholder-[#141414] placeholder-opacity-30 w-[120px] md:w-[250px] focus:outline-none focus:ring-0 focus:border-none text-right md:text-left">
                    </div>
                </div>

                <!-- Analyze Button -->
                <div class="relative w-full md:w-[662px] h-[60px] md:h-[92px]">
                    <button id="compareBtn" class="relative w-full md:w-[660px] h-[60px] md:h-[92px] bg-[#141414] rounded-2xl hover:bg-gray-800 transition-colors">
                        <div class="absolute top-[15px] md:top-[22px] left-1/2 md:left-[85px] transform -translate-x-1/2 md:transform-none font-bold text-[#fbf9f5] text-[18px] md:text-[40px] tracking-[0] leading-[normal] whitespace-nowrap">
                            ANALYZE COMPATIBILITY
                        </div>
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results" class="hidden w-full">
                <!-- Stats Cards -->
                <div class="flex flex-col md:flex-row items-center gap-4 md:gap-9 relative justify-center w-full mb-6 md:mb-[30px]">
                    <!-- Match Rate Card -->
                    <div class="relative w-full md:w-[429px] h-[200px] md:h-[356px]">
                        <div class="w-full md:w-[425px] h-[200px] md:h-[356px] bg-[#ffe250] relative rounded-2xl border-[3px] border-solid border-[#141414] flex flex-col items-center justify-center">
                            <div id="compatibilityScore" class="font-extrabold text-[#141414] text-[80px] md:text-[150px] tracking-[0] leading-[normal] mb-[-5px] md:mb-[-10px]">
                                0%
                            </div>
                            <div class="font-bold text-[#141414] text-[20px] md:text-[40px] text-center tracking-[0] leading-[normal] whitespace-nowrap">
                                COMPATIBILITY
                            </div>
                        </div>
                    </div>

                    <!-- Films in Common Card -->
                    <div class="relative w-full md:w-[428px] h-[200px] md:h-[356px]">
                        <div class="relative w-full md:w-[424px] h-[200px] md:h-[356px] bg-[#50d98a] rounded-2xl border-[3px] border-solid border-[#141414] flex flex-col items-center justify-center">
                            <div id="totalFilms" class="font-extrabold text-[#141414] text-[80px] md:text-[150px] tracking-[0] leading-[normal] mb-[-10px] md:mb-[-20px]">
                                0
                            </div>
                            <div class="font-bold text-[#141414] text-[20px] md:text-[40px] text-center tracking-[0] leading-[normal]">
                                FILMS<br />IN COMMON
                            </div>
                        </div>
                    </div>

                    <!-- Close Matches Card -->
                    <div class="relative w-full md:w-[429px] h-[200px] md:h-[356px]">
                        <div class="relative w-full md:w-[425px] h-[200px] md:h-[356px] bg-[#b788ef] rounded-2xl border-[3px] border-solid border-[#141414] flex flex-col items-center justify-center">
                            <div id="closeMatchesCount" class="font-extrabold text-[#141414] text-[80px] md:text-[150px] tracking-[0] leading-[normal] mb-[-10px] md:mb-[-20px]">
                                0
                            </div>
                            <div class="font-bold text-[#141414] text-[20px] md:text-[40px] text-center tracking-[0] leading-[normal]">
                                MATCHES
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Matches and Mismatches Section -->
                <div class="flex flex-col items-center gap-5 relative self-stretch w-full">
                    <div class="flex flex-col md:flex-row items-start gap-8 md:gap-[30px] relative justify-center w-full max-w-[1352px] mx-auto">
                        <div class="flex-1 w-full md:max-w-[660px]">
                            <div class="font-black text-[#141414] text-3xl md:text-6xl tracking-[0] leading-[normal] mb-5 text-center md:text-left">
                                MATCHES
                            </div>
                            <div id="matchesList" class="space-y-4">
                                <!-- Matches will be populated here -->
                            </div>
                        </div>
                        <div class="flex-1 w-full md:max-w-[660px]">
                            <div class="font-black text-[#141414] text-3xl md:text-6xl tracking-[0] leading-[normal] mb-5 text-center md:text-left">
                                MISMATCHES
                            </div>
                            <div id="mismatchesList" class="space-y-4">
                                <!-- Mismatches will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error State -->
            <div id="error" class="hidden w-full">
                <div class="w-full bg-[#ff6e58] rounded-2xl border-[3px] border-solid border-[#141414] p-6 text-center">
                    <div class="font-bold text-[#141414] text-[40px]" id="errorMessage"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const compareBtn = document.getElementById('compareBtn');
            const results = document.getElementById('results');
            const error = document.getElementById('error');

            async function handleSubmit(e) {
                e.preventDefault();
                
                const username1 = document.getElementById('username1').value.trim();
                const username2 = document.getElementById('username2').value.trim();
                
                if (!username1 || !username2) {
                    showError('Please enter both usernames');
                    return;
                }
                
                if (username1 === username2) {
                    showError('Please enter different usernames');
                    return;
                }
                
                hideAllMessages();
                showLoading();
                
                try {
                    const response = await fetch('/compare', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ username1, username2 })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showResults(data);
                    } else {
                        showError(data.error || 'An error occurred');
                    }
                } catch (err) {
                    showError('Failed to connect to server');
                }
            }

            compareBtn.addEventListener('click', handleSubmit);
            
            // Add enter key listeners to both input fields
            document.getElementById('username1').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSubmit(e);
                }
            });
            
            document.getElementById('username2').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSubmit(e);
                }
            });
            
            function showLoading() {
                compareBtn.disabled = true;
                compareBtn.classList.add('bg-gray-500');
                compareBtn.classList.remove('bg-[#141414]', 'hover:bg-gray-800');
                
                const buttonText = compareBtn.querySelector('div');
                let dots = 0;
                const animateEllipsis = () => {
                    dots = (dots + 1) % 4;
                    // Use fixed-width space to prevent shifting
                    const dotsText = '.'.repeat(dots).padEnd(3, '\u00A0'); // non-breaking space
                    buttonText.textContent = 'ANALYZING' + dotsText;
                };
                
                animateEllipsis();
                compareBtn.ellipsisInterval = setInterval(animateEllipsis, 500);
            }
            
            function hideLoading() {
                compareBtn.disabled = false;
                compareBtn.classList.remove('bg-gray-500');
                compareBtn.classList.add('bg-[#141414]', 'hover:bg-gray-800');
                
                const buttonText = compareBtn.querySelector('div');
                buttonText.textContent = 'ANALYZE COMPATIBILITY';
                
                if (compareBtn.ellipsisInterval) {
                    clearInterval(compareBtn.ellipsisInterval);
                    compareBtn.ellipsisInterval = null;
                }
            }
            
            function showResults(data) {
                hideLoading();
                
                const { compatibility, user1, user2 } = data;
                
                // Update stats with exact positioning
                document.getElementById('compatibilityScore').textContent = `${compatibility.compatibilityScore}%`;
                document.getElementById('totalFilms').textContent = compatibility.totalSharedFilms;
                document.getElementById('closeMatchesCount').textContent = compatibility.sharedFilmsCount;
                
                // Update matches label with proper singular/plural
                const closeMatchesLabel = document.querySelector('#closeMatchesCount').parentElement.querySelector('div:last-child');
                closeMatchesLabel.innerHTML = compatibility.sharedFilmsCount === 1 ? 'MATCH' : 'MATCHES';
                
                // Helper function to format rating as stars
                function formatRating(rating) {
                    const fullStars = Math.floor(rating);
                    const halfStar = rating % 1 >= 0.5;
                    return '★'.repeat(fullStars) + (halfStar ? '½' : '');
                }
                
                // Display matches using exact Figma card styling
                const matchesList = document.getElementById('matchesList');
                if (compatibility.closeMatches && compatibility.closeMatches.length > 0) {
                    matchesList.innerHTML = compatibility.closeMatches.map((film) => `
                        <a href="${film.url || '#'}" target="_blank" rel="noopener noreferrer" class="block">
                            <div class="relative w-full md:w-[660px] h-[120px] md:h-[152px] bg-[#51efec] rounded-2xl border-[3px] border-solid border-[#141414] hover:bg-opacity-80 transition-all">
                                <div class="absolute w-[calc(100%-40px)] md:w-[594px] top-[10px] md:top-[15px] left-[20px] md:left-[25px] font-semibold text-[#141414] text-xl md:text-3xl tracking-[0] leading-[normal] truncate">
                                    ${film.title}
                                </div>
                                <div class="absolute top-[45px] md:top-[67px] left-[20px] md:left-[25px] font-medium text-[#141414] text-base md:text-xl tracking-[0] leading-[normal]">
                                    ${user1}: ${formatRating(film.user1Rating)}
                                </div>
                                <div class="absolute top-[70px] md:top-[99px] left-[20px] md:left-[25px] font-medium text-[#141414] text-base md:text-xl tracking-[0] leading-[normal]">
                                    ${user2}: ${formatRating(film.user2Rating)}
                                </div>
                            </div>
                        </a>
                    `).join('');
                } else {
                    matchesList.innerHTML = '<div class="text-[#141414] text-xl">No matches found</div>';
                }
                
                // Display mismatches using exact Figma card styling
                const mismatchesList = document.getElementById('mismatchesList');
                if (compatibility.biggestDifferences && compatibility.biggestDifferences.length > 0) {
                    mismatchesList.innerHTML = compatibility.biggestDifferences.map((film) => `
                        <a href="${film.url || '#'}" target="_blank" rel="noopener noreferrer" class="block">
                            <div class="relative w-full md:w-[660px] h-[120px] md:h-[152px] bg-[#ff6e58] rounded-2xl border-[3px] border-solid border-[#141414] hover:bg-opacity-80 transition-all">
                                <div class="absolute w-[calc(100%-40px)] md:w-[594px] top-[10px] md:top-[15px] left-[20px] md:left-[25px] font-semibold text-[#141414] text-xl md:text-3xl tracking-[0] leading-[normal] truncate">
                                    ${film.title}
                                </div>
                                <div class="absolute top-[45px] md:top-[67px] left-[20px] md:left-[25px] font-medium text-[#141414] text-base md:text-xl tracking-[0] leading-[normal]">
                                    ${user1}: ${formatRating(film.user1Rating)}
                                </div>
                                <div class="absolute top-[70px] md:top-[99px] left-[20px] md:left-[25px] font-medium text-[#141414] text-base md:text-xl tracking-[0] leading-[normal]">
                                    ${user2}: ${formatRating(film.user2Rating)}
                                </div>
                            </div>
                        </a>
                    `).join('');
                } else {
                    mismatchesList.innerHTML = '<div class="text-[#141414] text-xl">No major disagreements (2+ star difference)</div>';
                }
                
                results.classList.remove('hidden');
            }
            
            function showError(message) {
                hideLoading();
                document.getElementById('errorMessage').textContent = message;
                error.classList.remove('hidden');
            }
            
            function hideAllMessages() {
                results.classList.add('hidden');
                error.classList.add('hidden');
            }
        });
    </script>
</body>
</html>